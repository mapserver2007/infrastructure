- name: copy ansible files
  copy: src={{ item.src }} dest={{ item.dest }}
  with_items:
    - { src: 'mysql/ansible',     dest: '/home/vagrant/{{ docker.webstream.label }}/mysql' }
    - { src: 'postgres/ansible',  dest: '/home/vagrant/{{ docker.webstream.label }}/postgres' }
    - { src: 'sqlite/ansible',    dest: '/home/vagrant/{{ docker.webstream.label }}/sqlite' }
    - { src: 'webstream/ansible', dest: '/home/vagrant/{{ docker.webstream.label }}/webstream' }
# WebStream(MySQL)
- name: docker run (mysql)
  shell: docker run -itd --privileged --volumes-from data_mysql --name webstream-mysql docker/mysql /sbin/init
  sudo: yes
- name: copy ansible files to container (mysql)
  shell: tar -cv * | sudo docker exec -i webstream-mysql tar x -C /root/ansible chdir=test-webstream/mysql/ansible
  sudo: yes
- name: docker provision (mysql)
  shell: docker exec -it webstream-mysql ansible-playbook -i "localhost," /root/ansible/settings.yml
  sudo: yes
# WebStream(PostgreSQL)
- name: docker run (postgres)
  shell: docker run -itd --privileged --volumes-from data_postgres --name webstream-postgres docker/postgres /sbin/init
  sudo: yes
- name: copy ansible files to container (postgres)
  shell: tar -cv * | sudo docker exec -i webstream-postgres tar x -C /root/ansible chdir=test-webstream/postgres/ansible
  sudo: yes
- name: docker provision (postgres)
  shell: docker exec -it webstream-postgres ansible-playbook -i "localhost," /root/ansible/settings.yml
  sudo: yes
# WebStream(SQLite)
- name: docker run (sqlite)
  shell: docker run -itd --privileged --volumes-from data_sqlite --name webstream-sqlite docker/sqlite /sbin/init
  sudo: yes
- name: copy ansible files to container (sqlite)
  shell: tar -cv * | sudo docker exec -i webstream-sqlite tar x -C /root/ansible chdir=test-webstream/sqlite/ansible
  sudo: yes
- name: docker provision (sqlite)
  shell: docker exec -it webstream-sqlite ansible-playbook -i "localhost," /root/ansible/settings.yml
  sudo: yes
# WebStream
- name: docker run (webstream)
  shell: docker run -itd -p 80:80 --link webstream-mysql:mysql --privileged --volumes-from data_apache --name webstream docker/php56-apache /sbin/init
  sudo: yes
- name: copy ansible files to container (webstream)
  shell: tar -cv * | sudo docker exec -i webstream tar x -C /root/ansible chdir=test-webstream/webstream/ansible
  sudo: yes
- name: docker provision (webstream)
  shell: docker exec -it webstream ansible-playbook -i "localhost," /root/ansible/settings.yml
  sudo: yes
